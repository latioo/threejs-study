<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      html {
        height: 100%;
      }

      body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      canvas {
        width: 100%;
        height: 100%;
      }

      #app {
        height: 80%;
        width: 80%;
        position: fixed;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>

  <body>
    <div id="app"></div>

    <script src="three.js"></script>

    <script src="src/TwoDimensionalControls.js"></script>
    <script src="src/convex-hull.js"></script>

    <script>
      var scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf0f0f0);
      var gridHelper = new THREE.GridHelper(100000, 1000, 0xa5a5a5, 0xdedede);
      gridHelper.rotation.x -= 0.5 * Math.PI;
      scene.add(gridHelper);

      scene.add(new THREE.AxesHelper(100)); // xyz -> 红绿蓝

      var camera = new THREE.OrthographicCamera(
        app.clientWidth / -2,
        app.clientWidth / 2,
        app.clientHeight / 2,
        app.clientHeight / -2,
        0.1,
        10000
      );

      var renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(app.clientWidth, app.clientHeight);
      app.appendChild(renderer.domElement);

      let controls = new THREE.TwoDimensionalControls(
        camera,
        renderer.domElement
      );
      // 也许? 正交相机下, camera.position 只能设置 xy 坐标, z设置为正即可
      // 使用 setStartZoom 设置初始大小
      controls.object.position.set(0, 0, 100);
      controls.maxZoom = 2;
      controls.minZoom = 0.1;
      controls.setStartZoom(0.8);
      controls.enableDamping = true;
      controls.showCompass(app);

      //
      let points = JSON.parse(
        '[{"x":0,"y":110},{"x":0,"y":125},{"x":0,"y":84},{"x":1,"y":97},{"x":2,"y":139},{"x":3,"y":152},{"x":3,"y":72},{"x":4,"y":164},{"x":8,"y":59},{"x":10,"y":177},{"x":11,"y":47},{"x":12,"y":189},{"x":13,"y":28},{"x":13,"y":37},{"x":15,"y":121},{"x":15,"y":202},{"x":17,"y":149},{"x":17,"y":201},{"x":18,"y":93},{"x":20,"y":212},{"x":20,"y":23},{"x":23,"y":69},{"x":24,"y":175},{"x":24,"y":42},{"x":29,"y":223},{"x":34,"y":149},{"x":35,"y":109},{"x":36,"y":169},{"x":36,"y":190},{"x":37,"y":234},{"x":38,"y":85},{"x":40,"y":207},{"x":42,"y":13},{"x":44,"y":30},{"x":45,"y":244},{"x":52,"y":254},{"x":53,"y":227},{"x":57,"y":44},{"x":59,"y":192},{"x":61,"y":212},{"x":62,"y":262},{"x":70,"y":246},{"x":70,"y":67},{"x":71,"y":271},{"x":73,"y":8},{"x":78,"y":202},{"x":81,"y":278},{"x":88,"y":263},{"x":88,"y":28},{"x":91,"y":284},{"x":94,"y":233},{"x":102,"y":290},{"x":102,"y":44},{"x":105,"y":8},{"x":110,"y":276},{"x":113,"y":248},{"x":114,"y":65},{"x":115,"y":296},{"x":122,"y":19},{"x":127,"y":302},{"x":131,"y":3},{"x":133,"y":285},{"x":133,"y":41},{"x":135,"y":259},{"x":136,"y":306},{"x":148,"y":18},{"x":150,"y":310},{"x":153,"y":64},{"x":155,"y":294},{"x":156,"y":266},{"x":162,"y":313},{"x":163,"y":42},{"x":166,"y":1},{"x":174,"y":314},{"x":178,"y":17},{"x":180,"y":271},{"x":180,"y":298},{"x":187,"y":316},{"x":195,"y":2},{"x":198,"y":39},{"x":200,"y":317},{"x":204,"y":271},{"x":207,"y":298},{"x":211,"y":15},{"x":213,"y":317},{"x":217,"y":61},{"x":222,"y":243},{"x":224,"y":0},{"x":225,"y":316},{"x":229,"y":0},{"x":231,"y":39},{"x":232,"y":296},{"x":235,"y":17},{"x":238,"y":315},{"x":244,"y":60},{"x":250,"y":80},{"x":251,"y":309},{"x":252,"y":98},{"x":253,"y":1},{"x":253,"y":1},{"x":253,"y":112},{"x":253,"y":208},{"x":253,"y":259},{"x":253,"y":288},{"x":254,"y":139},{"x":255,"y":153},{"x":256,"y":126},{"x":256,"y":166},{"x":256,"y":194},{"x":257,"y":181},{"x":260,"y":233},{"x":262,"y":34},{"x":264,"y":306},{"x":268,"y":133},{"x":269,"y":105},{"x":269,"y":120},{"x":269,"y":21},{"x":269,"y":215},{"x":269,"y":92},{"x":271,"y":147},{"x":271,"y":160},{"x":271,"y":201},{"x":273,"y":174},{"x":273,"y":187},{"x":273,"y":248},{"x":276,"y":301},{"x":279,"y":276},{"x":286,"y":102},{"x":286,"y":6},{"x":287,"y":119},{"x":287,"y":136},{"x":287,"y":153},{"x":287,"y":296},{"x":287,"y":85},{"x":288,"y":205},{"x":289,"y":170},{"x":290,"y":187},{"x":294,"y":235},{"x":297,"y":43},{"x":298,"y":289},{"x":299,"y":263},{"x":304,"y":104},{"x":305,"y":85},{"x":306,"y":124},{"x":306,"y":143},{"x":307,"y":183},{"x":308,"y":163},{"x":308,"y":202},{"x":310,"y":282},{"x":311,"y":51},{"x":312,"y":26},{"x":318,"y":247},{"x":319,"y":273},{"x":320,"y":16},{"x":323,"y":95},{"x":324,"y":114},{"x":324,"y":134},{"x":325,"y":173},{"x":326,"y":153},{"x":327,"y":192},{"x":328,"y":212},{"x":328,"y":264},{"x":334,"y":228},{"x":336,"y":254},{"x":342,"y":245},{"x":342,"y":35},{"x":343,"y":103},{"x":343,"y":84},{"x":344,"y":124},{"x":344,"y":144},{"x":344,"y":200},{"x":345,"y":163},{"x":345,"y":183},{"x":345,"y":57},{"x":351,"y":17},{"x":351,"y":17},{"x":351,"y":17},{"x":352,"y":234},{"x":357,"y":224},{"x":358,"y":185},{"x":362,"y":60},{"x":363,"y":213},{"x":365,"y":37},{"x":366,"y":160},{"x":367,"y":84},{"x":370,"y":135},{"x":370,"y":201},{"x":371,"y":110},{"x":373,"y":23},{"x":377,"y":189},{"x":381,"y":178},{"x":383,"y":165},{"x":385,"y":37},{"x":386,"y":17},{"x":386,"y":52},{"x":387,"y":152},{"x":387,"y":152},{"x":388,"y":62},{"x":388,"y":75},{"x":389,"y":139},{"x":391,"y":113},{"x":392,"y":126},{"x":392,"y":87},{"x":393,"y":100}]'
      );
      let convexHullPoints = getConvexHull(points);
      console.log(convexHullPoints);

      //
      var positions = [];
      var colors = [];
      var sizes = [];
      var color = new THREE.Color(0x888888);
      for (var i = 0; i < points.length; i++) {
        positions.push(points[i].x, points[i].y, 0);
        colors.push(color.r, color.g, color.b);
        sizes.push(1);
      }
      var geometry = new THREE.BufferGeometry();
      geometry.addAttribute(
        "position",
        new THREE.BufferAttribute(Float32Array.from(positions), 3)
      );
      geometry.addAttribute(
        "color",
        new THREE.BufferAttribute(Float32Array.from(colors), 3)
      );
      geometry.addAttribute(
        "size",
        new THREE.BufferAttribute(Float32Array.from(sizes), 1)
      );
      var material = new THREE.PointsMaterial({
        size: 3,
        vertexColors: THREE.VertexColors
      });
      particles = new THREE.Points(geometry, material);
      scene.add(particles);

      //
      var positions = [];
      var colors = [];
      var sizes = [];
      var color = new THREE.Color("#67C23A");
      for (var i = 0; i < convexHullPoints.length; i++) {
        positions.push(convexHullPoints[i].x, convexHullPoints[i].y, 0);
        colors.push(color.r, color.g, color.b);
        sizes.push(1);
      }
      var geometry = new THREE.BufferGeometry();
      geometry.addAttribute(
        "position",
        new THREE.BufferAttribute(Float32Array.from(positions), 3)
      );
      geometry.addAttribute(
        "color",
        new THREE.BufferAttribute(Float32Array.from(colors), 3)
      );
      geometry.addAttribute(
        "size",
        new THREE.BufferAttribute(Float32Array.from(sizes), 1)
      );
      var material = new THREE.PointsMaterial({
        size: 10,
        vertexColors: THREE.VertexColors
      });
      particles = new THREE.Points(geometry, material);
      scene.add(particles);

      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
        controls.update();
      }
      animate();

      addEventListener("resize", () => {
        camera.left = app.clientWidth / -2;
        camera.right = app.clientWidth / 2;
        camera.top = app.clientHeight / 2;
        camera.bottom = app.clientHeight / -2;
        camera.updateProjectionMatrix();
        renderer.setSize(app.clientWidth, app.clientHeight);
      });
    </script>
  </body>
</html>
